[api]
enabled = true
address = "0.0.0.0:8686"

# Docker logs source
[sources.docker_logs]
type = "docker_logs"
include_containers = ["mt5zmq", "grafana", "victoriametrics", "victorialogs", "vmagent"]

# Log processing/transformation
[transforms.parse_logs]
type = "remap"
inputs = ["docker_logs"]
source = '''
.timestamp = now()
.service = .container_name

# Attempt to parse JSON-formatted logs
parsed, err = parse_json(.message)
if err == null && is_object(parsed) {
  . = merge!(., parsed)
}
'''

# Output to VictoriaLogs via Loki-compatible API
[sinks.victorialogs]
type = "loki"
inputs = ["parse_logs"]
endpoint = "http://victorialogs:9428/insert"
encoding.codec = "json"

[sinks.victorialogs.labels]
service = "{{ service }}"
container = "{{ container_name }}"
