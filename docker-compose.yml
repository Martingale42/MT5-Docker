version: '3.8'
services:
  mt5zmq:
    build: .
    image: mt5zmq:latest
    container_name: mt5zmq
    restart: unless-stopped
    ports:
      - '5900:5900'    # VNC
      - '2201:2201'    # System socket (REQ/REP)
      - '2202:2202'    # Data socket (PUSH)
      - '2203:2203'    # Live socket (PUSH)
      - '2204:2204'    # Stream socket (PUSH)
    volumes:
      - ./Metatrader/MQL5/Experts:/root/Metatrader/MQL5/Experts
      - ./Metatrader/MQL5/Include:/root/Metatrader/MQL5/Include
      - ./data:/root/data
      - mt5zmq-config:/root/Metatrader/Config
      - mt5zmq-bases:/root/Metatrader/Bases
      - mt5zmq-logs:/root/Metatrader/logs
      - mt5zmq-profiles:/root/Metatrader/Profiles
      - mt5zmq-tester:/root/Metatrader/Tester
      - mt5zmq-wine:/root/.wine
    environment:
      - USER=root
      - PASSWORD=root
    deploy:
      resources:
        limits:
          cpus: '4'          # Max 4 cores
          memory: 2G         # Max 2GB
        reservations:
          cpus: '4'          # Guaranteed 2 cores
          memory: 1G         # Guaranteed 2G

  # swagger-ui:
  #   image: nginx:alpine
  #   container_name: mt5-swagger-ui
  #   restart: unless-stopped
  #   ports:
  #     - '8080:80'
  #   volumes:
  #     - ./docs/openapi:/usr/share/nginx/html:ro
  #   profiles:
  #     - docs
  #   depends_on:
  #     - mt5zmq

  # mt5-exporter:
  #   build: .
  #   image: mt5zmq:latest
  #   container_name: mt5-exporter
  #   restart: unless-stopped
  #   command: python3 /root/monitoring/prometheus_exporter.py --port 9090 --mt5-host mt5zmq --interval 30
  #   ports:
  #     - '9090:9090'
  #   volumes:
  #     - ./monitoring:/root/monitoring:ro
  #     - ./scripts:/root/scripts:ro
  #   profiles:
  #     - monitoring
  #   depends_on:
  #     - mt5zmq

  # prometheus:
  #   image: prom/prometheus:latest
  #   container_name: mt5-prometheus
  #   restart: unless-stopped
  #   ports:
  #     - '9091:9090'
  #   volumes:
  #     - ./monitoring/prometheus:/etc/prometheus:ro
  #     - prometheus-data:/prometheus
  #   command:
  #     - '--config.file=/etc/prometheus/prometheus.yml'
  #     - '--storage.tsdb.path=/prometheus'
  #     - '--web.console.libraries=/usr/share/prometheus/console_libraries'
  #     - '--web.console.templates=/usr/share/prometheus/consoles'
  #   profiles:
  #     - monitoring
  #   depends_on:
  #     - mt5-exporter

  # grafana:
  #   image: grafana/grafana:latest
  #   container_name: mt5-grafana
  #   restart: unless-stopped
  #   ports:
  #     - '3000:3000'
  #   volumes:
  #     - grafana-data:/var/lib/grafana
  #     - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards:ro
  #   environment:
  #     - GF_SECURITY_ADMIN_USER=admin
  #     - GF_SECURITY_ADMIN_PASSWORD=admin
  #     - GF_USERS_ALLOW_SIGN_UP=false
  #   profiles:
  #     - monitoring
  #   depends_on:
  #     - prometheus

volumes:
  mt5zmq-data:
  mt5zmq-config:
  mt5zmq-bases:
  mt5zmq-logs:
  mt5zmq-profiles:
  mt5zmq-tester:
  mt5zmq-wine:
  # prometheus-data:
  # grafana-data: